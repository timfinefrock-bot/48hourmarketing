<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>48 Hour Marketing - Agent Brand Profile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
            margin: 20px 0;
        }

        h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .section-title {
            margin-top: 24px;
            margin-bottom: 12px;
            font-weight: 700;
            color: #2d3748;
            font-size: 16px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .form-row {
            display: flex;
            gap: 12px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            color: #2d3748;
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 13px;
        }

        label .required {
            color: #e53e3e;
        }

        input, textarea, select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        select[multiple] {
            min-height: 120px;
        }

        .hint {
            font-size: 11px;
            color: #a0aec0;
            margin-top: 4px;
        }

        .upload-box {
            background: #f8f9fa;
            border: 2px dashed #cbd5e0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
        }

        .upload-box:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .upload-box.has-file {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .upload-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .upload-text {
            color: #4a5568;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .upload-subtext {
            color: #a0aec0;
            font-size: 12px;
        }

        .file-preview {
            display: none;
            margin-top: 8px;
            padding: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            align-items: center;
            gap: 8px;
        }

        .file-preview.active {
            display: flex;
        }

        .file-preview-icon {
            color: #48bb78;
            font-size: 16px;
        }

        .file-preview-name {
            flex: 1;
            color: #2d3748;
            font-size: 13px;
            text-align: left;
        }

        .file-remove-btn {
            background: #f56565;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .file-remove-btn:hover {
            background: #e53e3e;
        }

        .submit-btn {
            width: 100%;
            margin-top: 24px;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 16px;
            font-size: 14px;
            color: #4a5568;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
            margin: 0 auto 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-message,
        .error-message {
            display: none;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            margin-top: 16px;
            font-size: 14px;
        }

        .success-message {
            background: #48bb78;
            color: white;
        }

        .error-message {
            background: #f56565;
            color: white;
        }

        .success-message.active,
        .error-message.active {
            display: block;
        }

        .color-input-wrapper {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            border: 2px solid #e2e8f0;
        }

        .color-input-wrapper input[type="text"] {
            flex: 1;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>48 Hour Marketing</h1>
    <p class="subtitle">Agent Brand Onboarding Profile</p>

    <form id="brandForm">
        <!-- Agent Information -->
        <div class="section-title">Agent Information</div>

        <div class="form-row">
            <div class="form-group">
                <label for="agentFirstName">First Name <span class="required">*</span></label>
                <input type="text" id="agentFirstName" required>
            </div>
            <div class="form-group">
                <label for="agentLastName">Last Name <span class="required">*</span></label>
                <input type="text" id="agentLastName" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="agentPhone">Phone Number <span class="required">*</span></label>
                <input type="tel" id="agentPhone" placeholder="(555) 123-4567" maxlength="14" required>
            </div>
            <div class="form-group">
                <label for="agentEmail">Email <span class="required">*</span></label>
                <input type="email" id="agentEmail" placeholder="agent@example.com" required>
            </div>
        </div>

        <div class="form-group">
            <label for="agentWebsite">Website</label>
            <input type="text" id="agentWebsite" placeholder="www.example.com or https://example.com">
            <div class="hint">Optional - include or omit https://</div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="agentLicenseNumber">RE License Number <span class="required">*</span></label>
                <input type="text" id="agentLicenseNumber" required>
            </div>
            <div class="form-group">
                <label for="agentLicensedStates">States Licensed <span class="required">*</span></label>
                <select id="agentLicensedStates" multiple required>
                    <option value="AL">Alabama</option>
                    <option value="AK">Alaska</option>
                    <option value="AZ">Arizona</option>
                    <option value="AR">Arkansas</option>
                    <option value="CA">California</option>
                    <option value="CO">Colorado</option>
                    <option value="CT">Connecticut</option>
                    <option value="DE">Delaware</option>
                    <option value="FL">Florida</option>
                    <option value="GA">Georgia</option>
                    <option value="HI">Hawaii</option>
                    <option value="ID">Idaho</option>
                    <option value="IL">Illinois</option>
                    <option value="IN">Indiana</option>
                    <option value="IA">Iowa</option>
                    <option value="KS">Kansas</option>
                    <option value="KY">Kentucky</option>
                    <option value="LA">Louisiana</option>
                    <option value="ME">Maine</option>
                    <option value="MD">Maryland</option>
                    <option value="MA">Massachusetts</option>
                    <option value="MI">Michigan</option>
                    <option value="MN">Minnesota</option>
                    <option value="MS">Mississippi</option>
                    <option value="MO">Missouri</option>
                    <option value="MT">Montana</option>
                    <option value="NE">Nebraska</option>
                    <option value="NV">Nevada</option>
                    <option value="NH">New Hampshire</option>
                    <option value="NJ">New Jersey</option>
                    <option value="NM">New Mexico</option>
                    <option value="NY">New York</option>
                    <option value="NC">North Carolina</option>
                    <option value="ND">North Dakota</option>
                    <option value="OH">Ohio</option>
                    <option value="OK">Oklahoma</option>
                    <option value="OR">Oregon</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="RI">Rhode Island</option>
                    <option value="SC">South Carolina</option>
                    <option value="SD">South Dakota</option>
                    <option value="TN">Tennessee</option>
                    <option value="TX">Texas</option>
                    <option value="UT">Utah</option>
                    <option value="VT">Vermont</option>
                    <option value="VA">Virginia</option>
                    <option value="WA">Washington</option>
                    <option value="WV">West Virginia</option>
                    <option value="WI">Wisconsin</option>
                    <option value="WY">Wyoming</option>
                </select>
                <div class="hint">Hold Ctrl (Windows) or Cmd (Mac) to select multiple</div>
            </div>
        </div>

        <div class="form-group">
            <label for="brokerageName">Brokerage Name <span class="required">*</span></label>
            <input type="text" id="brokerageName" required>
        </div>

        <div class="form-group">
            <label for="brokerageAddress">Brokerage Address <span class="required">*</span></label>
            <input type="text" id="brokerageAddress" placeholder="123 Main St, City, ST 12345" required>
            <div class="hint">Full address including city, state, and ZIP</div>
        </div>

        <div class="form-group">
            <label for="teamName">Team Name</label>
            <input type="text" id="teamName">
            <div class="hint">Optional - leave blank if not applicable</div>
        </div>

        <!-- Brand Information -->
        <div class="section-title">Brand Information</div>

        <div class="form-group">
            <label for="brandTagline">Brand Tagline</label>
            <input type="text" id="brandTagline" placeholder="One short, memorable line">
            <div class="hint">Optional - a brief phrase that captures your brand</div>
        </div>

        <div class="form-group">
            <label for="brandDescription">Brand Description <span class="required">*</span></label>
            <textarea id="brandDescription" required placeholder="Describe your brand and what makes you different. Include your ideal clients, style, differentiators, and promises."></textarea>
        </div>

        <div class="form-group">
            <label for="brandTone">Brand Tone <span class="required">*</span></label>
            <select id="brandTone" multiple required>
                <option value="fun and friendly">Fun and Friendly</option>
                <option value="minimalistic">Minimalistic</option>
                <option value="luxury">Luxury</option>
                <option value="professional">Professional</option>
                <option value="bright and colorful">Bright and Colorful</option>
                <option value="modern">Modern</option>
                <option value="dark">Dark</option>
                <option value="light">Light</option>
            </select>
            <div class="hint">Hold Ctrl (Windows) or Cmd (Mac) to select multiple</div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="colorPrimary">Primary Color <span class="required">*</span></label>
                <div class="color-input-wrapper">
                    <div class="color-preview" id="colorPrimaryPreview"></div>
                    <input type="text" id="colorPrimary" placeholder="#FF6600" required>
                </div>
                <div class="hint">HEX format: #FF6600</div>
            </div>
            <div class="form-group">
                <label for="colorSecondary">Secondary Color</label>
                <div class="color-input-wrapper">
                    <div class="color-preview" id="colorSecondaryPreview"></div>
                    <input type="text" id="colorSecondary" placeholder="#111111">
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="colorTertiary">Tertiary Color</label>
            <div class="color-input-wrapper">
                <div class="color-preview" id="colorTertiaryPreview"></div>
                <input type="text" id="colorTertiary" placeholder="#FFFFFF">
            </div>
        </div>

        <!-- Image Uploads -->
        <div class="section-title">Brand Assets</div>

        <div class="form-group">
            <label>Logo</label>
            <div class="upload-box" id="logoUploadBox" data-type="logo">
                <div class="upload-icon">üñºÔ∏è</div>
                <div class="upload-text">Click to upload logo</div>
                <div class="upload-subtext">Will be cropped to square format</div>
            </div>
            <div class="file-preview" id="logoPreview">
                <span class="file-preview-icon">‚úì</span>
                <span class="file-preview-name" id="logoName"></span>
                <button type="button" class="file-remove-btn" onclick="removeFile('logo')">Remove</button>
            </div>
        </div>

        <div class="form-group">
            <label>Headshot</label>
            <div class="upload-box" id="headshotUploadBox" data-type="headshot">
                <div class="upload-icon">üë§</div>
                <div class="upload-text">Click to upload headshot</div>
                <div class="upload-subtext">Will be cropped to square format</div>
            </div>
            <div class="file-preview" id="headshotPreview">
                <span class="file-preview-icon">‚úì</span>
                <span class="file-preview-name" id="headshotName"></span>
                <button type="button" class="file-remove-btn" onclick="removeFile('headshot')">Remove</button>
            </div>
        </div>

        <div class="form-group">
            <label>16:9 Brand Images (up to 2)</label>
            <div class="upload-box" id="brandImage16x9UploadBox" data-type="brandImage16x9">
                <div class="upload-icon">üì∑</div>
                <div class="upload-text">Click to upload 16:9 images</div>
                <div class="upload-subtext">Landscape format - select up to 2 images</div>
            </div>
            <div id="brandImage16x9List"></div>
        </div>

        <div class="form-group">
            <label>4:4 Brand Images (up to 2)</label>
            <div class="upload-box" id="brandImage4x4UploadBox" data-type="brandImage4x4">
                <div class="upload-icon">üñºÔ∏è</div>
                <div class="upload-text">Click to upload 4:4 square images</div>
                <div class="upload-subtext">Square format - select up to 2 images</div>
            </div>
            <div id="brandImage4x4List"></div>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">
            Submit Brand Profile
        </button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Saving your profile and generating brand files‚Ä¶</p>
        </div>

        <div class="success-message" id="successMessage">
            ‚úì Your brand profile has been successfully submitted! We will build your materials on this foundation.
        </div>

        <div class="error-message" id="errorMessage">
            <span id="errorText">Something went wrong. Please try again.</span>
        </div>
    </form>
</div>

<script src="https://apis.google.com/js/api.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDKPQbbWsIXV0NmhWKoYsyxJIfQ166L1bs&libraries=places"></script>
<script>
    // Configuration
    const CONFIG = {
        clientId: '461191446774-8d44l3lo8ahlqksnll406hfa2i3eoqoj.apps.googleusercontent.com',
        apiKey: 'AIzaSyAkBwhFJH5OvSsSDMLZiWR5iDqU70QW5OQ',
        webhookUrl: 'https://tfinefrock.app.n8n.cloud/webhook/658c581a-b19f-4ada-a99d-9c8ed7e40834',
        uploadFolderId: '1r6LQ4Lg_EbnLN-AZL_L-zJ189HuNBM69'
    };

    // State management
    let pickerInited = false;
    let gisInited = false;
    let tokenClient;
    let accessToken = null;
    let currentUploadType = null;

    const uploadedFiles = {
        logo: null,
        headshot: null,
        brandImage16x9: [],
        brandImage4x4: []
    };

    // Phone number auto-formatting
    document.getElementById('agentPhone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
    
    if (value.length > 10) {
        value = value.slice(0, 10); // Limit to 10 digits
    }
    
    let formatted = '';
    if (value.length > 0) {
        formatted = '(' + value.substring(0, 3);
    }
    if (value.length >= 4) {
        formatted += ') ' + value.substring(3, 6);
    }
    if (value.length >= 7) {
        formatted += '-' + value.substring(6, 10);
    }
    
    e.target.value = formatted;
    });

    // Address autocomplete
    let autocomplete;
    function initAutocomplete() {
    const addressInput = document.getElementById('brokerageAddress');
    
    autocomplete = new google.maps.places.Autocomplete(addressInput, {
        types: ['address'],
        componentRestrictions: { country: 'us' }
    });
    
    autocomplete.addListener('place_changed', function() {
        const place = autocomplete.getPlace();
        if (place.formatted_address) {
            addressInput.value = place.formatted_address;
        }
    });
    }

// Initialize autocomplete when page loads
window.addEventListener('load', function() {
    if (typeof google !== 'undefined' && google.maps && google.maps.places) {
        initAutocomplete();
    }
    });

    // Initialize Google APIs
    function gapiLoaded() {
        gapi.load('client:picker', initializePicker);
    }

    function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CONFIG.clientId,
            scope: 'https://www.googleapis.com/auth/drive.file',
            callback: ''
        });
        gisInited = true;
    }

    async function initializePicker() {
        await gapi.client.load('https://www.googleapis.com/discovery/v1/apis/drive/v3/rest');
        pickerInited = true;
    }

    // Handle upload box clicks
    document.querySelectorAll('.upload-box').forEach(box => {
        box.addEventListener('click', function() {
            currentUploadType = this.getAttribute('data-type');
            handleAuthClick();
        });
    });

    function handleAuthClick() {
        if (!gisInited || !pickerInited) {
            alert('Google Picker is still loading. Please try again in a moment.');
            return;
        }

        tokenClient.callback = (response) => {
            if (response.error !== undefined) {
                console.error(response);
                return;
            }
            accessToken = response.access_token;
            createPicker();
        };

        if (accessToken === null) {
            tokenClient.requestAccessToken({ prompt: 'consent' });
        } else {
            tokenClient.requestAccessToken({ prompt: '' });
        }
    }

    function createPicker() {
        const view = new google.picker.DocsView(google.picker.ViewId.DOCS);
        view.setMimeTypes('image/png,image/jpeg,image/jpg');

        const uploadView = new google.picker.DocsUploadView();
        uploadView.setMimeTypes('image/png,image/jpeg,image/jpg');
        uploadView.setParent(CONFIG.uploadFolderId);  // SET UPLOAD FOLDER HERE

        let builder = new google.picker.PickerBuilder()
            .enableFeature(google.picker.Feature.NAV_HIDDEN)
            .setDeveloperKey(CONFIG.apiKey)
            .setAppId(CONFIG.clientId.split('-')[0])
            .setOAuthToken(accessToken)
            .addView(uploadView)
            .addView(view)
            .setCallback(pickerCallback);

        // Enable multi-select for 16x9 and 4x4 images
        if (currentUploadType === 'brandImage16x9' || currentUploadType === 'brandImage4x4') {
            builder.enableFeature(google.picker.Feature.MULTISELECT_ENABLED);
        }

        builder.build().setVisible(true);
    }

    function pickerCallback(data) {
        if (data.action === google.picker.Action.PICKED) {
            const files = data.docs.map(doc => ({
                id: doc.id,
                name: doc.name
            }));

            if (currentUploadType === 'logo') {
                uploadedFiles.logo = files[0];
                displaySingleFile('logo', files[0]);
            } else if (currentUploadType === 'headshot') {
                uploadedFiles.headshot = files[0];
                displaySingleFile('headshot', files[0]);
            } else if (currentUploadType === 'brandImage16x9') {
                const limit = 2;
                uploadedFiles.brandImage16x9 = files.slice(0, limit);
                displayMultipleFiles('brandImage16x9', uploadedFiles.brandImage16x9);
            } else if (currentUploadType === 'brandImage4x4') {
                const limit = 2;
                uploadedFiles.brandImage4x4 = files.slice(0, limit);
                displayMultipleFiles('brandImage4x4', uploadedFiles.brandImage4x4);
            }
        }
    }

    function displaySingleFile(type, file) {
        const preview = document.getElementById(`${type}Preview`);
        const nameElement = document.getElementById(`${type}Name`);
        const uploadBox = document.getElementById(`${type}UploadBox`);

        nameElement.textContent = file.name;
        preview.classList.add('active');
        uploadBox.classList.add('has-file');
    }

    function displayMultipleFiles(type, files) {
        const listElement = document.getElementById(`${type}List`);
        const uploadBox = document.getElementById(`${type}UploadBox`);

        listElement.innerHTML = files.map((file, index) => `
            <div class="file-preview active" style="margin-top: 8px;">
                <span class="file-preview-icon">‚úì</span>
                <span class="file-preview-name">${file.name}</span>
                <button type="button" class="file-remove-btn" onclick="removeFileFromArray('${type}', ${index})">Remove</button>
            </div>
        `).join('');

        if (files.length > 0) {
            uploadBox.classList.add('has-file');
        } else {
            uploadBox.classList.remove('has-file');
        }
    }

    function removeFile(type) {
        uploadedFiles[type] = null;
        const preview = document.getElementById(`${type}Preview`);
        const uploadBox = document.getElementById(`${type}UploadBox`);
        preview.classList.remove('active');
        uploadBox.classList.remove('has-file');
    }

    function removeFileFromArray(type, index) {
        uploadedFiles[type].splice(index, 1);
        displayMultipleFiles(type, uploadedFiles[type]);
    }

    // Color preview functionality
    ['colorPrimary', 'colorSecondary', 'colorTertiary'].forEach(id => {
        const input = document.getElementById(id);
        const preview = document.getElementById(id + 'Preview');

        input.addEventListener('input', function() {
            const color = this.value.trim();
            if (color.match(/^#[0-9A-Fa-f]{6}$/)) {
                preview.style.backgroundColor = color;
            } else {
                preview.style.backgroundColor = '#e2e8f0';
            }
        });
    });

    // Form submission
    document.getElementById('brandForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');

        // Hide previous messages
        successMessage.classList.remove('active');
        errorMessage.classList.remove('active');

        // Get selected states
        const statesSelect = document.getElementById('agentLicensedStates');
        const selectedStates = Array.from(statesSelect.selectedOptions).map(opt => opt.value);

        // Get selected brand tones
        const toneSelect = document.getElementById('brandTone');
        const selectedTones = Array.from(toneSelect.selectedOptions).map(opt => opt.value);

        // Validate required fields
        if (selectedStates.length === 0) {
            errorText.textContent = 'Please select at least one licensed state.';
            errorMessage.classList.add('active');
            return;
        }

        if (selectedTones.length === 0) {
            errorText.textContent = 'Please select at least one brand tone.';
            errorMessage.classList.add('active');
            return;
        }

        // Build payload
        const payload = {
            agentFirstName: document.getElementById('agentFirstName').value.trim(),
            agentLastName: document.getElementById('agentLastName').value.trim(),
            agentPhone: document.getElementById('agentPhone').value.trim(),
            agentEmail: document.getElementById('agentEmail').value.trim(),
            agentWebsite: document.getElementById('agentWebsite').value.trim() || null,
            agentLicenseNumber: document.getElementById('agentLicenseNumber').value.trim(),
            agentLicensedStates: selectedStates,
            brokerageName: document.getElementById('brokerageName').value.trim(),
            brokerageAddress: document.getElementById('brokerageAddress').value.trim(),
            teamName: document.getElementById('teamName').value.trim() || null,
            brandTagline: document.getElementById('brandTagline').value.trim() || null,
            brandDescription: document.getElementById('brandDescription').value.trim(),
            brandTone: selectedTones,
            colorPrimary: document.getElementById('colorPrimary').value.trim(),
            colorSecondary: document.getElementById('colorSecondary').value.trim() || null,
            colorTertiary: document.getElementById('colorTertiary').value.trim() || null,
            logoImageId: uploadedFiles.logo ? uploadedFiles.logo.id : null,
            headshotImageId: uploadedFiles.headshot ? uploadedFiles.headshot.id : null,
            brandImage16x9Ids: uploadedFiles.brandImage16x9.map(f => f.id),
            brandImage4x4Ids: uploadedFiles.brandImage4x4.map(f => f.id)
        };

        // Submit to webhook
        submitBtn.disabled = true;
        loading.classList.add('active');

        try {
            const response = await fetch(CONFIG.webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            });

            const raw = await response.text();
            let result = null;

            try {
              result = raw ? JSON.parse(raw) : null;
            } catch (e) {
            console.warn('Non-JSON response from webhook:', raw);
            }

            if (!response.ok) {
              if (result && Array.isArray(result.missingFields) && result.missingFields.length) {
                errorText.textContent = `Missing required fields: ${result.missingFields.join(', ')}`;
              } else {
                errorText.textContent = 'Failed to submit profile. Please try again.';
              }
              throw new Error('Submission failed');
            }

            // Success
            loading.classList.remove('active');
            successMessage.classList.add('active');
            
            // Optionally reset form
            // document.getElementById('brandForm').reset();
            // Object.keys(uploadedFiles).forEach(key => {
            //     if (Array.isArray(uploadedFiles[key])) {
            //         uploadedFiles[key] = [];
            //     } else {
            //         uploadedFiles[key] = null;
            //     }
            // });

        } catch (err) {
            console.error(err);
            loading.classList.remove('active');
            errorMessage.classList.add('active');
        } finally {
            submitBtn.disabled = false;
        }
    });

    // Initialize on load
    gapiLoaded();
</script>
<script src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
